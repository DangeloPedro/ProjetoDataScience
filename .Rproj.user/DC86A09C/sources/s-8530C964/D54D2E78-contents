library("basedosdados")
library(tidyverse)
set_billing_id("projeto-ciencia-de-dados-2022")
set_billing_id("projeto-ciencia-de-dados-2022")
query <- bdplyr("br_sp_gov_ssp.ocorrencias_registradas")%>%
sample_n(50)
query <- bdplyr("br_sp_gov_ssp.ocorrencias_registradas")
df <- bd_collect(query)
summary(df)
head(df)
View(df)
OR = df
query <- bdplyr("br_sp_gov_ssp.produtividade_policial")
PP <- bd_collect(query)
levels(as.factor(df$id_municipio))
levels(as.factor(df$regiao_ssp))
df[df$regiao_ssp == 'Capital']
df[df$regiao_ssp == 'Capital',5]
levels(as.factor(df$regiao_ssp))
View(PP)
QR$data <- zoo:as.yearmon(paste(QR$ano, df$mes), "%m %Y")
library(zoo)
QR$data <- as.yearmon(paste(QR$ano, df$mes), "%m %Y")
OR$data <- as.yearmon(paste(OR$ano, OR$mes), "%m %Y")
OR$data
class(OR$mes)
OR$data <- as.yearmon(paste(OR$ano, OR$mes), "%m %Y")
OR$data <- as.yearmon(paste(OR$ano, OR$mes), "%Y %m")
class(OR$mes)
OR$data
library("reshape2")
PP$data <- as.yearmon(paste(PP$ano, PP$mes), "%Y %m")
is.data.frame(OR)
rm(df)
test_data_long <- melt(OR, id="data")  # convert to long format
ggplot(data=test_data_long,
aes(x=date, y=value, colour=variable)) +
geom_line()
View(test_data_long)
View(OR)
test_data_long <- melt(OR[,5:28], id="data")  # convert to long format
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
test_data_long <- melt(OR[,5:10], id="data")  # convert to long format
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
colnames(OR)
test_data_long <- melt(OR[,5:10], id="data") %>%
filter(regiao_ssp =! 'Capital')# convert to long format
test_data_long <- melt(OR[,5:10], id="data") %>%
filter(regiao_ssp != 'Capital')# convert to long format
test_data_long <- melt(OR[,5:10], id="data")# convert to long format
test_data_long <- melt(OR[,c(5:10, 28)], id="data") %>%
filter(regiao_ssp != 'Capital')# convert to long format
colnames(OR)
test_data_long <- melt(OR[,c(5:10, 28)], id="data") %>%
filter(ano>2009)# convert to long format
test_data_long <-OR[,c(5:10, 28)] >%>
filter(ano>2009)%>%
melt(id="data")
test_data_long <-OR[,c(5:10, 28)] %>%
filter(regiao_ssp != 'Capital') %>%
melt(id="data")
test_data_long <-OR[,c(5:10, 28)] %>%
filter(regiao_ssp != 'Capital') %>%
melt(id="data")
test_data_long <-OR[,c(4:10, 28)] %>%
filter(regiao_ssp != 'Capital') %>%
select(-regiao_ssp)%>%
melt(id="data")
View(test_data_long)
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
test_data_long <-OR[,c(4:10, 28)] %>%
filter(regiao_ssp == 'Bauru') %>%
select(-regiao_ssp)%>%
melt(id="data")
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
View(test_data_long)
test_data_long <-OR[,c(4:10, 28)] %>%
filter(id_municipio == '3523008' ) %>%
select(-id_municipio)%>%
melt(id="data")
colnames(OR)
test_data_long <-OR %>%
filter(id_municipio == '3523008' ) %>%
select(homicidio_doloso:homicidio_culposo_outros, data)%>%
melt(id="data")
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
test_data_long <-OR %>%
filter(id_municipio == '3550308' ) %>%
select(homicidio_doloso:homicidio_culposo_outros, data)%>%
melt(id="data")
ggplot(data=test_data_long,
aes(x=data, y=value, colour=variable)) +
geom_line()
library("basedosdados")
library(tidyverse)
library(zoo)
library("reshape2")
OR$regiao_ssp = 'Capital'
query <- bdplyr("br_sp_gov_ssp.ocorrencias_registradas")
OR <- bd_collect(query)
set_billing_id("projeto-ciencia-de-dados-2022")
query <- bdplyr("br_sp_gov_ssp.ocorrencias_registradas")
query <- bdplyr("br_sp_gov_ssp.ocorrencias_registradas")
OR <- bd_collect(query)
OR$data <- as.yearmon(paste(OR$ano, OR$mes), "%Y %m")
which(OR$regiao_ssp == 'Capital')
OR[1249,]
5!=
5
or_capital = OR %>%
filter(id_municipio == '3550308')
or_other  = OR %>%
filter(id_municipio != '3550308')
View(or_capital)
View(or_other)
colnames(or_capital)
levels(as.factor(OR$regiao_ssp))
any(OR$homicidio_doloso == 0 & OR$homicidio_doloso_por_acidente_de_transito == 1)
(OR$homicidio_doloso == 0 & OR$homicidio_doloso_por_acidente_de_transito == 1)
(OR$homicidio_doloso == 0 & OR$homicidio_doloso_por_acidente_de_transito == 1, na.exclude = T)
any(OR$homicidio_doloso == 0 & OR$homicidio_doloso_por_acidente_de_transito == 1, na.rm = T)
any(OR$homicidio_doloso == 1 & OR$homicidio_doloso_por_acidente_de_transito == 1, na.rm = T)
any(OR$homicidio_doloso == 1 & OR$homicidio_doloso_por_acidente_de_transito == 0, na.rm = T)
aux_line = or_capital%>%
select(data, homicidio_doloso, homicidio_doloso_por_acidente_de_transito,
homicidio_culposo_por_acidente_de_transito, homicidio_culposo_outros,
tentativa_de_homicidio, lesao_corporal_seguida_de_morte, latrocinio)%>%
melt(id = 'data')
View(aux_line)
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
colnames(or_capital)
aux_line = or_capital%>%
select(-ano:regiao_ssp)
aux_line = or_capital%>%
select(-c(ano:regiao_ssp))
aux_line = or_capital%>%
select(-c(ano:regiao_ssp))%>%
melt(id = 'data')
grupo_1 = c('homicidio_doloso', 'homicidio_doloso_por_acidente_de_transito',
'homicidio_culposo_por_acidente_de_transito', 'homicidio_culposo_outros',
'tentativa_de_homicidio', 'lesao_corporal_seguida_de_morte', 'latrocinio')
grupo_2 = colnames(or_capital)[c(13:15, 18:20)]
grupo_4 = colnames(or_capital)[c(22:27)]
aux_line$Grupo = NA
for(i in 1:nrow(aux_line)){
var_temp = aux_line$variable[i]
if(any(var_temp == grupo_1)){
aux_line$Grupo == '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo == '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo == '3'
}
}
grupo_3 = colnames(or_capital)[c(22:27)]
for(i in 1:nrow(aux_line)){
var_temp = aux_line$variable[i]
if(any(var_temp == grupo_1)){
aux_line$Grupo == '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo == '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo == '3'
}
}
aux_line$Grupo = NA
grupo_1 = c('homicidio_doloso', 'homicidio_doloso_por_acidente_de_transito',
'homicidio_culposo_por_acidente_de_transito', 'homicidio_culposo_outros',
'tentativa_de_homicidio', 'lesao_corporal_seguida_de_morte', 'latrocinio')
grupo_2 = colnames(or_capital)[c(13:15, 18:20)]
grupo_3 = colnames(or_capital)[c(22:27)]
for(i in 1:nrow(aux_line)){
var_temp = aux_line$variable[i]
if(any(var_temp == grupo_1)){
aux_line$Grupo[i] == '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo[i] == '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo[i] == '3'
}
}
as.character(aux_line$variable[i])
for(i in 1:nrow(aux_line)){
var_temp = as.character(aux_line$variable[i])
if(any(var_temp == grupo_1)){
aux_line$Grupo[i] == '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo[i] == '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo[i] == '3'
}
}
colnames(or_capital)
var_temp == grupo_3
any(var_temp == grupo_3)
for(i in 1:nrow(aux_line)){
var_temp = as.character(aux_line$variable[i])
if(any(var_temp == grupo_1)){
aux_line$Grupo[i] = '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo[i] = '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo[i] = '3'
}
}
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~.)
aux_line = filter(aux_line, -Grupo == NA)
aux_line = filter(aux_line, Grupo != NA)
aux_line = or_capital%>%
select(-c(ano:regiao_ssp))%>%
melt(id = 'data')
aux_line$Grupo = NA
grupo_1 = c('homicidio_doloso', 'homicidio_doloso_por_acidente_de_transito',
'homicidio_culposo_por_acidente_de_transito', 'homicidio_culposo_outros',
'tentativa_de_homicidio', 'lesao_corporal_seguida_de_morte', 'latrocinio')
grupo_2 = colnames(or_capital)[c(13:15, 18:20)]
grupo_3 = colnames(or_capital)[c(22:27)]
for(i in 1:nrow(aux_line)){
var_temp = as.character(aux_line$variable[i])
if(any(var_temp == grupo_1)){
aux_line$Grupo[i] = '1'
}
else if(any(var_temp == grupo_2)){
aux_line$Grupo[i] = '2'
}
else if(any(var_temp == grupo_3)){
aux_line$Grupo[i] = '3'
}
}
aux_line = filter(aux_line, grupo %in% c('1', '2', '3'))
aux_line = filter(aux_line, Grupo %in% c('1', '2', '3'))
View(aux_line)
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~.)
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_brewer(palette="Dark2")
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_brewer(palette="Dark2")
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_brewer(palette="Dark")
install.packages('wesanderson')
library(wesanderson)
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values=wes_palette(n=20, name="GrandBudapest"))
wes_palettes
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values=wes_palette(n=20, name="GrandBudapest1"))
getPalette = colorRampPalette(brewer.pal(20, "Set1"))
library(RColorBrewer)
getPalette = colorRampPalette(brewer.pal(20, "Set1"))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual()
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values = getPalette(20))
getPalette = colorRampPalette(brewer.pal(9, "BrBG"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values = getPalette(20))
getPalette = colorRampPalette(brewer.pal(2, "BrBG"))
getPalette = colorRampPalette(brewer.pal(3, "BrBG"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values = getPalette(20))
getPalette = colorRampPalette(brewer.pal(7, "BrBG"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values = getPalette(20))
getPalette = colorRampPalette(brewer.pal(7, "Set3"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')+
scale_color_manual(values = getPalette(20))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line() +facet_grid(Grupo ~., scales = 'free')
aux_line = or_capital%>%
select(-c(ano:regiao_ssp))%>%
melt(id = 'data')
colnames(or_capital)
aux_line = or_capital%>%
select(homicidio_doloso, homicidio_culposo_outros, tentativa_de_homicidio,
lesao_corporal_seguida_de_morte,latrocinio)%>%
melt(id = 'data')
getPalette = colorRampPalette(brewer.pal(7, "Set3"))
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
aux_line = or_capital%>%
select(homicidio_doloso, homicidio_culposo_outros, tentativa_de_homicidio,
lesao_corporal_seguida_de_morte,latrocinio)%>%
melt(id = 'data')
aux_line = or_capital%>%
select(data, homicidio_doloso, homicidio_culposo_outros, tentativa_de_homicidio,
lesao_corporal_seguida_de_morte,latrocinio)%>%
melt(id = 'data')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
colnames(or_capital)
aux_line = or_capital%>%
select(data,lesao_corporal_seguida_de_morte:
lesao_corporal_culposa_outras)%>%
melt(id = 'data')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
aux_line = or_capital%>%
select(data,lesao_corporal_seguida_de_morte:
lesao_corporal_culposa_outras, total_de_estupro:estupro_de_vulneravel)%>%
melt(id = 'data')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
aux_line = or_capital%>%
select(data,roubo_outros:furto_de_veiculo)%>%
melt(id = 'data')
ggplot(data=aux_line,
aes(x=data, y=value, colour=variable)) +
geom_line()
